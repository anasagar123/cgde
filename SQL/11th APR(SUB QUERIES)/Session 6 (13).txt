use test;

SELECT * FROM EMP;

SELECT * FROM EMP_SAL;

SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER';

sELECT EID, NAME, CITY FROM EMP;

sELECT EID, NAME, CITY FROM EMP
WHERE EID IN(1004,1007,1008,1010,1013,1028,1067,1040,1074,1088,1123);

sELECT EID, NAME, CITY FROM EMP -- OUTER \ MAIN
WHERE EID IN(SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER'); -- INNER \SUB

SELECT EID, DEPT, DESI, SALARY FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI');

SELECT EMP.EID, NAME, DEPT, DESI
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS';

SELECT * FROM TRAINING;

DELETE TRAINING;

-- INSERT SUB QUERY

INSERT INTO TRAINING (EID ,NAME, DEPT)
SELECT EMP.EID, NAME, DEPT
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS'; 


UPDATE TRAINING SET MODULE = 'SQL';

-- DELETE SUB QUERY
DELETE FROM TRAINING 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI LIKE 'MANAGER%');

SELECT * from training;


SELECT * FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP  WHERE CITY = 'DEHRADUN');

-- UPDATE SUB QUERY
UPDATE EMP_SAL SET SALARY = SALARY + 5000
WHERE EID IN (SELECT EID FROM EMP  WHERE CITY = 'DEHRADUN');

sELECT EID, NAME, CITY FROM EMP 
WHERE EID IN(SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER');

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000 )
ORDER BY EID DESC;

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 500000 );

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY BETWEEN 200000 AND 300000 );

SELECT COUNT(EID) AS 'NO OF EMP', AVG(SALARY) AS 'AVGSAL' 
FROM EMP_SAL;

SELECT COUNT(EID) AS 'NO OF DEL EMP', AVG(SALARY) AS 'DELAVGSAL' FROM EMP_SAL 
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI');

SELECT COUNT(EID) AS 'NO OF DEL EMP > 300K', AVG(SALARY) AS 'DELAVGSAL>300K' FROM EMP_SAL --A
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI' AND  --B
				EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000)); -- C

-- A => B => C  A=>C

SELECT * FROM EMP_SAL WHERE DEPT = 'HR'
AND EXISTS (SELECT * FROM EMP_SAL WHERE DEPT = 'HR' AND SALARY > 300000);

CREATE PROCEDURE LB37DEMP
AS
BEGIN	
	SELECT * FROM EMP
	WHERE CITY = 'DELHI';
END;

CREATE PROCEDURE LB37DEMP @C AS VARCHAR(30)
AS
BEGIN	
	SELECT * FROM EMP
	WHERE CITY = @C;
END;

DROP PROCEDURE LB37DEMP;
EXECUTE LB37DEMP;

EXEC LB37DEMP;

LB37DEMP 'DELHI'; 

CREATE PROCEDURE L37SHOW @T AS VARCHAR(30)
AS
BEGIN
	EXEC('SELECT * FROM ' + @T);
END;

L37SHOW 'EMP';

INSERT INTO EMP
VALUES (1225, 'RAMESH GROVER',  'MAHAGUN APARTMENTS','SECTOR 78', 'NOIDA', '9855556670','RGROVER@YAHOO.COM', '25-MAR-1991', '25-JAN-2021');


DELETE FROM EMP WHERE EID = 1225;
DELETE FROM EMP_SAL WHERE EID = 1225;

SELECT * FROM EMP;

drop PROCEDURE LB37INEMP ;

CREATE PROCEDURE LB37INEMP @ID AS INT, @N AS VARCHAR (30),@A1  AS VARCHAR (30),@A2  AS VARCHAR (30),@C  AS VARCHAR (30),@PH AS CHAR(15), @EM AS VARCHAR (50),@DB AS DATE, @DJ AS DATE
AS
BEGIN 
	
	INSERT INTO EMP
	VALUES(@ID, @N , @A1, @A2, @C, @PH, @EM, @DB, @DJ);

	SELECT * FROM EMP WHERE EID = @ID;
END;

LB37INEMP 1225, 'RAMESH GROVER',  'MAHAGUN APARTMENTS','SECTOR 78', 'NOIDA', '9855556670','RGROVER@YAHOO.COM', '25-MAR-1991', '25-JAN-2021';

SELECT * FROM EMP_SAL;


CREATE PROCEDURE LB37INEMP @ID AS INT, @N AS VARCHAR (30),@A1  AS VARCHAR (30),@A2  AS VARCHAR (30),@C  AS VARCHAR (30),@PH AS CHAR(15), @EM AS VARCHAR (50),@DB AS DATE, @DJ AS DATE, @DPT AS VARCHAR(20), @DSI AS VARCHAR(30) ,@S AS INT
AS
BEGIN 
	SET NOCOUNT ON;	
	INSERT INTO EMP
	VALUES(@ID, @N , @A1, @A2, @C, @PH, @EM, @DB, @DJ);

	INSERT INTO EMP_SAL
	VALUES(@ID, @DPT, @DSI, @S);

	SELECT * FROM EMP WHERE EID = @ID;

	SELECT * FROM EMP_SAL WHERE EID = @ID;

	SELECT EMP.EID , NAME, CITY , DOJ , DEPT, DESI, SALARY AS 'BASIC', SALARY *.15 AS 'HRA', SALARY *.09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID = EMP_SAL.EID
	WHERE EMP.EID = @ID;
END;

LB37INEMP 1225, 'RAMESH GROVER',  'MAHAGUN APARTMENTS','SECTOR 78', 'NOIDA', '9855556670','RGROVER@YAHOO.COM', '25-MAR-1991', '25-JAN-2021', 'TEMP','ASSOCIATE', 70000 ;

