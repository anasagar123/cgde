CREATE TABLE EmployeeInfo (
    EmpID INT PRIMARY KEY,                -- Unique identifier for each employee
    EmpFname NVARCHAR(50) NOT NULL,       -- Employee's first name
    EmpLname NVARCHAR(50) NOT NULL,       -- Employee's last name
    Department NVARCHAR(50),              -- Department where the employee works
    Project NVARCHAR(100),                -- Project assigned to the employee
    Address NVARCHAR(255),                -- Employee's address
    DOB DATE,                             -- Employee's date of birth
    Gender CHAR(1)                        -- Employee's gender (M/F/O for Male/Female/Other)
);

INSERT INTO EmployeeInfo (EmpID, EmpFname, EmpLname, Department, Project, Address, DOB, Gender)
VALUES 
(1, 'Sanjay', 'Mehra', 'HR', 'P1', 'Hyderabad', '1985-06-15', 'M'),
(2, 'Ananya', 'Mishra', 'Admin', 'P2', 'Delhi', '1990-09-23', 'F'),
(3, 'Rohan', 'Diwan', 'Account', 'P3', 'Mumbai', '1982-12-02', 'M'),
(4, 'Sonia', 'Kulkarni', 'HR', 'P1', 'Hyderabad', '1988-03-14', 'F');

select * from EmployeeInfo

CREATE TABLE EmployeePosition (
    EmpID INT ,
    EmpPosition NVARCHAR(50) NOT NULL,
    DateOfJoining DATE NOT NULL,
    Salary int NOT NULL
);


INSERT INTO EmployeePosition (EmpID, EmpPosition, DateOfJoining, Salary)
VALUES 
(1, 'Manager', '2015-01-20', 500000),
(2, 'Executive', '2016-03-15', 75000),
(3, 'Manager', '2017-06-10', 90000),
(2, 'Lead', '2018-09-01', 85000),
(1, 'Executive', '2015-01-20',300000);

select * from EmployeePosition

--- Write a query to fetch the EmpFname from the EmployeeInfo table in the upper case and use the ALIAS name as EmpName.

select upper(EmpFname) as EmpName  from EmployeeInfo

---- Write a query to fetch the number of employees working in the department ‘HR’.

select count(Department) from EmployeeInfo where Department = 'HR'
select count(*) from EmployeeInfo where Department = 'HR'

--- Write a query to get the current date.

select GETDATE();

---- Write a query to retrieve the first four characters of  EmpLname from the EmployeeInfo table.
SELECT SUBSTRING(EmpLname, 1, 4) FROM EmployeeInfo;

--- Write a query to fetch only the place name(string before brackets) from the Address column of EmployeeInfo table.

SELECT SUBSTRING(Address, 1, CHARINDEX('(',Address)) FROM EmployeeInfo;

--- Write a query to create a new table that consists of data and structure copied from the other table.
    ---select * into newtable from EmployeeInfo where 1=0 
select * into Newemployeeinfo from EmployeeInfo

select * from Newemployeeinfo

--- Write q query to find all the employees whose salary is between 50000 to 100000.
select * from EmployeePosition
select * from EmployeePosition where Salary between 50000 AND 100000

--- Write a query to find the names of employees that begin with ‘S’
select * from EmployeeInfo where EmpFname like 'S%'

--- Write a query to fetch top N records.
select top 10 * from EmployeePosition order by Salary desc

--- Write a query to retrieve the EmpFname and EmpLname in a single column as “FullName”. The first name and the last name must be separated with space.
select concat(EmpFname, ' ',EmpLname) as FullName from EmployeeInfo

--- Write a query find number of employees whose DOB is between 02/05/1970 to 31/12/1975 and are grouped according to gender.
select count(*),Gender from EmployeeInfo where DOB between 02-12-1982 and 14-03-1988 group by Gender

--- Write a query to fetch all the records from the EmployeeInfo table ordered by EmpLname in descending order and Department in the ascending order.
select * from EmployeeInfo order by EmpLname desc,Department asc

--- Write a query to fetch details of employees whose EmpLname ends with an alphabet ‘A’ and contains five alphabets.
select * from EmployeeInfo where EmpLname like '_____A'

--- Write a query to fetch details of all employees excluding the employees with first names, “Sanjay” and “Sonia” from the EmployeeInfo table.
select * from EmployeeInfo where EmpFname not in('Sanjay','Sonia')

--- Write a query to fetch details of employees with the address as “DELHI(DEL)”.
select * from EmployeeInfo where Address ='Delhi'
select * from EmployeePosition


--- Write a query to fetch all employees who also hold the managerial position.
select * from EmployeePosition where EmpPosition='Manager'

select E.EmpFname,E.EmpLname,E.Project,P.EmpPosition,P.Salary from EmployeeInfo E inner join
EmployeePosition P on E.EmpID = P.EmpID where P.EmpPosition ='Manager'

SELECT E.EmpFname, E.EmpLname, P.EmpPosition 
FROM EmployeeInfo E INNER JOIN EmployeePosition P ON
E.EmpID = P.EmpID AND P.EmpPosition IN ('Manager');

--- Write a query to fetch the department-wise count of employees sorted by department’s count in ascending order.
select Department,Count(EmpID) as Dept from EmployeeInfo group by Department order by Dept desc

--- Write a query to calculate the even and odd records from a table.

select * from (select ROW_NUMBER() over (order by EmpID asc) 'rowno' from EmployeeInfo)T 
where T.rowno%2=0

select * from (select ROW_NUMBER() over (order by EmpID asc) 'rowno' from EmployeeInfo)T
where T.rowno%2=1

--- Write a SQL query to retrieve employee details from EmployeeInfo table who have a date of joining in the EmployeePosition table.
select * from EmployeeInfo E
where exists (select * from EmployeePosition P where E.EmpID=P.EmpID)

--- Write a query to retrieve two minimum and maximum salaries from the EmployeePosition table.
-- two minimum and 
SELECT TOP 2 Salary as minsal
FROM EmployeePosition
ORDER BY Salary ASC 

--- two maximum salaries
SELECT TOP 2 Salary as maxsal
FROM EmployeePosition
ORDER BY Salary DESC;

--- Write a query to find the Nth highest salary from the table without using TOP/limit keyword.

SELECT Salary FROM 
(SELECT Salary, ROW_NUMBER() OVER (ORDER BY salary DESC) as row_num FROM EmployeePosition)T
WHERE row_num = N;

--- 3rd highest
SELECT DISTINCT Salary
FROM EmployeePosition
ORDER BY Salary DESC
OFFSET 2 ROWS     --- OFFSET 2 ROWS: Skips the first two rows (the highest and second-highest salaries).
FETCH NEXT 1 ROWS ONLY;

select top 5 Salary from EmployeePosition order by Salary desc

--- Write a query to retrieve the list of employees working in the same department.
select * from EmployeeInfo
select * from EmployeePosition

select E1.EmpID,E1.EmpFname,E1.EmpLname,E1.Department,E1.Address,E1.Gender,
E2.Project,E2.Address,E2.Gender from EmployeeInfo E1
join EmployeeInfo E2 on  E1.Department=E2.Department and E1.EmpID!=E2.EmpID 

--- Write a query to retrieve the last 3 records from the EmployeeInfo table.
select * from EmployeeInfo 
order by EmpID desc 
offset 0 rows
fetch next 3 rows only

--- Write a query to find the third-highest salary from the EmpPosition table.
select * from EmployeePosition
order by Salary desc
offset 2 rows
fetch next 1 rows only

--- Write a query to display the first and the last record from the EmployeeInfo table.
 
 --- first record
select * from EmployeeInfo
order by EmpID asc
offset 0 rows
fetch next 1 rows only

--- last record
select * from EmployeeInfo
order by EmpID desc
offset 0 rows
fetch next 1 rows only

--- Write a query to add email validation to your database
SELECT Email FROM EmployeeInfo WHERE NOT REGEXP_LIKE(Email, ‘[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}’, ‘i’);

--- Write a query to retrieve Departments who have less than 2 employees working in it.
select Department,count(EmpID) as 'EmpNo' from EmployeeInfo group by Department having count(EmpID)<2

--- Write a query to retrieve EmpPostion along with total salaries paid for each of them.
select EmpPosition,sum(Salary) from EmployeePosition group by EmpPosition

--- Write a query to fetch 50% records from the EmployeeInfo table.
select * from EmployeeInfo where EmpID <=(select count(EmpID)/2 from EmployeeInfo)

---Q1. How do you read the last five records from a database using a SQL query?
--To retrieve the last five records from a database using a SQL query, you can use the ORDER BY clause combined with LIMIT. Here’s an example query:

SELECT * FROM your_table ORDER BY id DESC LIMIT 5;

--- Q2. Write a SQL query that will provide you with the 10th-highest employee salary from an Employee table.

SELECT salary FROM (SELECT salary, ROW_NUMBER() OVER (ORDER BY salary DESC) AS row_num FROM Employee) AS ranked_salary
WHERE row_num = 10;

--- Q3. Write a query to get the last record from a table.
select * from EmployeeInfo
order by EmpID desc
offset 0 rows
fetch next 1 rows only


